{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "ApimServiceName": {
      "type": "string"
    }
  },
  "resources": [
    {
      "properties": {
        "description": "dev api-geo",
        "isCurrent": false,
        "subscriptionRequired": true,
        "displayName": "dev-api-geo",
        "serviceUrl": "https://geo.api.gouv.fr",
        "path": "/dev/api-geo",
        "protocols": [
          "https"
        ],
        "value": "swagger: 2.0\r\ninfo:\r\n  title: dev api-geo\r\n  version: 1.0\r\nhost: geo.api.gouv.fr\r\nschemes:\r\n- https\r\nproduces:\r\n- application/json\r\nparameters:\r\n  communeFieldsParam:\r\n    name: fields\r\n    in: query\r\n    description: Liste des champs souhaités dans la réponse\r\n    type: array\r\n    items:\r\n      type: string\r\n      enum:\r\n      - nom\r\n      - code\r\n      - codesPostaux\r\n      - centre\r\n      - surface\r\n      - contour\r\n      - codeDepartement\r\n      - departement\r\n      - codeRegion\r\n      - region\r\n      - population\r\n    collectionFormat: csv\r\n    default:\r\n    - nom\r\n    - code\r\n    - codesPostaux\r\n    - codeDepartement\r\n    - codeRegion\r\n    - population\r\n  departementFieldsParam:\r\n    name: fields\r\n    in: query\r\n    description: Liste des champs souhaités dans la réponse\r\n    type: array\r\n    items:\r\n      type: string\r\n      enum:\r\n      - nom\r\n      - code\r\n      - codeRegion\r\n      - region\r\n    collectionFormat: csv\r\n    default:\r\n    - nom\r\n    - code\r\n    - codeRegion\r\n  regionFieldsParam:\r\n    name: fields\r\n    in: query\r\n    description: Liste des champs souhaités dans la réponse\r\n    type: array\r\n    items:\r\n      type: string\r\n      enum:\r\n      - nom\r\n      - code\r\n    collectionFormat: csv\r\n    default:\r\n    - nom\r\n    - code\r\n  formatParam:\r\n    name: format\r\n    in: query\r\n    description: Format de réponse attendu\r\n    type: string\r\n    enum:\r\n    - json\r\n    - geojson\r\n    default: json\r\n  communeGeometryParam:\r\n    name: geometry\r\n    in: query\r\n    description: Géométrie à utiliser pour la sortie géographique\r\n    type: string\r\n    enum:\r\n    - centre\r\n    - contour\r\n    default: centre\r\n  limitParam:\r\n    name: limit\r\n    in: query\r\n    description: Nombre d'éléments à retourner\r\n    type: integer\r\n    format: int32\r\n    default: 0\r\npaths:\r\n  /communes:\r\n    get:\r\n      summary: Recherche des communes\r\n      tags:\r\n      - Communes\r\n      parameters:\r\n      - name: codePostal\r\n        in: query\r\n        description: Code postal associé\r\n        type: string\r\n      - name: lat\r\n        in: query\r\n        description: Latitude (en degrés)\r\n        type: number\r\n        format: float\r\n      - name: lon\r\n        in: query\r\n        description: Longitude (en degrés)\r\n        type: number\r\n        format: float\r\n      - name: nom\r\n        in: query\r\n        description: Nom de la commune\r\n        type: string\r\n      - name: boost\r\n        in: query\r\n        description: Mode de boost de la recherche par nom\r\n        type: string\r\n      - name: code\r\n        in: query\r\n        description: Code de la commune\r\n        type: string\r\n      - name: codeDepartement\r\n        in: query\r\n        description: Code du département associé\r\n        type: string\r\n      - name: codeRegion\r\n        in: query\r\n        description: Code de la région associée\r\n        type: string\r\n      - $ref: '#/parameters/communeFieldsParam'\r\n      - $ref: '#/parameters/formatParam'\r\n      - $ref: '#/parameters/communeGeometryParam'\r\n      responses:\r\n        200:\r\n          description: Liste de communes\r\n          schema:\r\n            type: array\r\n            items:\r\n              $ref: '#/definitions/Commune'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /communes/{code}:\r\n    get:\r\n      summary: Récupérer les informations concernant une commune\r\n      tags:\r\n      - Communes\r\n      parameters:\r\n      - name: code\r\n        in: path\r\n        description: Code INSEE de la commune\r\n        required: true\r\n        type: string\r\n      - $ref: '#/parameters/communeFieldsParam'\r\n      - $ref: '#/parameters/formatParam'\r\n      - $ref: '#/parameters/communeGeometryParam'\r\n      responses:\r\n        200:\r\n          description: Informations concernant une commune\r\n          schema:\r\n            $ref: '#/definitions/Commune'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n        404:\r\n          description: Commune introuvable\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /departements:\r\n    get:\r\n      summary: Recherche des départements\r\n      tags:\r\n      - Départements\r\n      parameters:\r\n      - name: code\r\n        in: query\r\n        description: Code du département\r\n        type: string\r\n      - name: codeRegion\r\n        in: query\r\n        description: Code région associé\r\n        type: string\r\n      - name: nom\r\n        in: query\r\n        description: Nom du département\r\n        type: string\r\n      - $ref: '#/parameters/departementFieldsParam'\r\n      responses:\r\n        200:\r\n          description: Le ou les départements\r\n          schema:\r\n            type: array\r\n            items:\r\n              $ref: '#/definitions/Departement'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /departements/{code}:\r\n    get:\r\n      summary: Récupérer les informations concernant un département\r\n      tags:\r\n      - Départements\r\n      parameters:\r\n      - name: code\r\n        in: path\r\n        description: Code du département\r\n        required: true\r\n        type: string\r\n      - $ref: '#/parameters/departementFieldsParam'\r\n      responses:\r\n        200:\r\n          description: Informations concernant un département\r\n          schema:\r\n            $ref: '#/definitions/Departement'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n        404:\r\n          description: Département introuvable\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /departements/{code}/communes:\r\n    get:\r\n      summary: Renvoi les communes d'un département\r\n      tags:\r\n      - Départements\r\n      - Communes\r\n      parameters:\r\n      - name: code\r\n        in: path\r\n        description: Code du département\r\n        required: true\r\n        type: string\r\n      - $ref: '#/parameters/communeFieldsParam'\r\n      - $ref: '#/parameters/formatParam'\r\n      - $ref: '#/parameters/communeGeometryParam'\r\n      responses:\r\n        200:\r\n          description: Liste des communes du département\r\n          schema:\r\n            $ref: '#/definitions/Commune'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n        404:\r\n          description: Département introuvable\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /regions:\r\n    get:\r\n      summary: Recherche des régions\r\n      tags:\r\n      - Régions\r\n      parameters:\r\n      - name: code\r\n        in: query\r\n        description: Code de la région\r\n        type: string\r\n      - name: nom\r\n        in: query\r\n        description: Nom de la région\r\n        type: string\r\n      - $ref: '#/parameters/regionFieldsParam'\r\n      responses:\r\n        200:\r\n          description: La ou les régions\r\n          schema:\r\n            type: array\r\n            items:\r\n              $ref: '#/definitions/Region'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /regions/{code}:\r\n    get:\r\n      summary: Récupérer les informations concernant une région\r\n      tags:\r\n      - Régions\r\n      parameters:\r\n      - name: code\r\n        in: path\r\n        description: Code de la région\r\n        required: true\r\n        type: string\r\n      - $ref: '#/parameters/regionFieldsParam'\r\n      responses:\r\n        200:\r\n          description: Informations concernant la région\r\n          schema:\r\n            $ref: '#/definitions/Departement'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n        404:\r\n          description: Région introuvable\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n  /regions/{code}/departements:\r\n    get:\r\n      summary: Renvoi les départements d'une région\r\n      tags:\r\n      - Départements\r\n      - Régions\r\n      parameters:\r\n      - name: code\r\n        in: path\r\n        description: Code de la région\r\n        required: true\r\n        type: string\r\n      - $ref: '#/parameters/regionFieldsParam'\r\n      responses:\r\n        200:\r\n          description: Liste des départements de la région\r\n          schema:\r\n            $ref: '#/definitions/Departement'\r\n        400:\r\n          description: Erreur. Requête mal formée\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\n        404:\r\n          description: Département introuvable\r\n          schema:\r\n            $ref: '#/definitions/Error'\r\ndefinitions:\r\n  Error:\r\n    type: object\r\n    properties:\r\n      code:\r\n        type: integer\r\n        description: Code HTTP de l'erreur\r\n      message:\r\n        type: string\r\n        description: Libellé de l'erreur\r\n      description:\r\n        type: string\r\n        description: Explication\r\n  Commune:\r\n    type: object\r\n    properties:\r\n      code:\r\n        type: string\r\n        description: Code INSEE de la commune\r\n      nom:\r\n        type: string\r\n        description: Nom de la commune\r\n      codesPostaux:\r\n        type: array\r\n        description: Liste des codes postaux associés à la commune\r\n        items:\r\n          type: string\r\n      codeDepartement:\r\n        type: string\r\n        description: Code du département associé à la commune\r\n      codeRegion:\r\n        type: string\r\n        description: Code de la région associée à la commune\r\n      departement:\r\n        $ref: '#/definitions/Departement'\r\n      region:\r\n        $ref: '#/definitions/Region'\r\n      population:\r\n        type: integer\r\n        description: Population municipale\r\n      surface:\r\n        type: number\r\n        format: float\r\n        description: Surface de la commune, en hectares\r\n      centre:\r\n        type: object\r\n        description: Centre de la commune (Point GeoJSON)\r\n      contour:\r\n        type: object\r\n        description: Contour de la commune (Polygon GeoJSON)\r\n  Departement:\r\n    type: object\r\n    properties:\r\n      code:\r\n        type: string\r\n        description: Code du département\r\n      nom:\r\n        type: string\r\n        description: Nom du département\r\n      codeRegion:\r\n        type: string\r\n        description: Code de la région\r\n      region:\r\n        $ref: '#/definitions/Region'\r\n  Region:\r\n    type: object\r\n    properties:\r\n      code:\r\n        type: string\r\n        description: Code de la région\r\n      nom:\r\n        type: string\r\n        description: Nom de la région\r\n",
        "format": "openapi"
      },
      "name": "[concat(parameters('ApimServiceName'), '/dev-api-geo')]",
      "type": "Microsoft.ApiManagement/service/apis",
      "apiVersion": "2019-01-01",
      "dependsOn": []
    },
    {
      "properties": {},
      "name": "[concat(parameters('ApimServiceName'), '/api-geo-product-dev/dev-api-geo')]",
      "type": "Microsoft.ApiManagement/service/products/apis",
      "apiVersion": "2019-01-01",
      "dependsOn": [
        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('ApimServiceName'), 'dev-api-geo')]"
      ]
    }
  ]
}